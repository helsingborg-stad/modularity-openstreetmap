{"version":3,"file":"js/modularity-open-street-map.f75ee828e0bcb36c5c55.js","mappings":"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","sources":["webpack://@helsingborg-stad/modularity-openstreetmap/./source/js/taxonomySelectUpdater.ts","webpack://@helsingborg-stad/modularity-openstreetmap/./source/js/storage.ts","webpack://@helsingborg-stad/modularity-openstreetmap/./source/js/main.ts","webpack://@helsingborg-stad/modularity-openstreetmap/webpack/bootstrap","webpack://@helsingborg-stad/modularity-openstreetmap/./source/js/module.js","webpack://@helsingborg-stad/modularity-openstreetmap/./source/js/gutenberg.js","webpack://@helsingborg-stad/modularity-openstreetmap/./source/js/modularity-open-street-map.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass TaxonomySelectUpdater {\n    constructor(selectFieldKey, storage) {\n        this.selectFieldKey = selectFieldKey;\n        this.storage = storage;\n    }\n    // Updates the existing rows.\n    updateExistsingRows(container, postType) {\n        const taxonomies = this.storage.getTaxonomies(postType);\n        const selectedValues = this.storage.getSelected(postType);\n        [...container.querySelectorAll(`tr.acf-row:not(.acf-clone) [data-key=\"${this.selectFieldKey}\"] select`)].forEach((selectField, index) => {\n            selectField.innerHTML = \"\";\n            this.addSelectFieldOptions(selectField, index, taxonomies, selectedValues);\n        });\n    }\n    // Adds the taxonomies as options to the select field.\n    addSelectFieldOptions(selectField, index, taxonomies, selectedValues) {\n        for (const key in taxonomies) {\n            const option = document.createElement('option');\n            option.selected = selectedValues[index] && selectedValues[index] === key ? true : false;\n            option.value = key;\n            option.text = taxonomies[key];\n            selectField.appendChild(option);\n        }\n    }\n}\nexports.default = TaxonomySelectUpdater;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass Storage {\n    constructor(taxonomies, selected) {\n        this.taxonomies = taxonomies;\n        this.selected = selected;\n    }\n    getSelected(postType) {\n        if (this.selected.hasOwnProperty(postType)) {\n            return this.selected[postType];\n        }\n        return [];\n    }\n    getTaxonomies(postType) {\n        if (this.taxonomies.hasOwnProperty(postType)) {\n            return this.taxonomies[postType];\n        }\n        return [];\n    }\n}\nexports.default = Storage;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass Main {\n    constructor(container, acf, postTypeSelectFieldKey, filterSelectFieldKey, storageInstance, taxonomySelectUpdaterInstance) {\n        this.container = container;\n        this.acf = acf;\n        this.postTypeSelectFieldKey = postTypeSelectFieldKey;\n        this.filterSelectFieldKey = filterSelectFieldKey;\n        this.storageInstance = storageInstance;\n        this.taxonomySelectUpdaterInstance = taxonomySelectUpdaterInstance;\n        const postTypeSelect = this.container.querySelector(`[data-key=\"${this.postTypeSelectFieldKey}\"] select`);\n        if (postTypeSelect) {\n            if (postTypeSelect.value) {\n                this.taxonomySelectUpdaterInstance.updateExistsingRows(this.container, postTypeSelect.value);\n            }\n            this.listenForPostTypeChanges(postTypeSelect);\n            this.listenForFilterRowsAdded(postTypeSelect);\n        }\n    }\n    // Listens for changes in the post type select field.\n    listenForPostTypeChanges(postTypeSelect) {\n        postTypeSelect.addEventListener('change', (event) => {\n            const selectedValue = event.target.value;\n            this.taxonomySelectUpdaterInstance.updateExistsingRows(this.container, selectedValue);\n        });\n    }\n    // Listens for rows added in an ACF repeater field.\n    // Updates the matching block/modules select field that was appended.\n    listenForFilterRowsAdded(postTypeSelect) {\n        this.acf.addAction('append', (jqueryEl) => {\n            if (!jqueryEl.hasOwnProperty(0) || !jqueryEl[0].classList.contains('acf-row') || !this.container.contains(jqueryEl[0])) {\n                return;\n            }\n            const selectField = jqueryEl[0].querySelector(`[data-key=\"${this.filterSelectFieldKey}\"] select`);\n            if (selectField) {\n                this.taxonomySelectUpdaterInstance.addSelectFieldOptions(selectField, 0, this.storageInstance.getTaxonomies(postTypeSelect.value), []);\n            }\n        });\n    }\n}\nexports.default = Main;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import TaxonomySelectUpdater from \"./taxonomySelectUpdater\";\nimport Storage from \"./storage\";\nimport Main from \"./main\";\n\nclass Module {\n    constructor() {\n        const filterSelectFieldKey = 'field_668d1cc80d853';\n        const postTypeSelectFieldKey = 'field_642a8818a908c';\n        const container = document.querySelector('#acf-group_64219abb0caec');\n\n        if (container) {\n            const [taxonomies, selected] = this.getOsm();\n            const storageInstance = new Storage(taxonomies, selected);\n            const taxonomySelectUpdaterInstance = new TaxonomySelectUpdater(filterSelectFieldKey, storageInstance);\n            new Main(container, acf, postTypeSelectFieldKey, filterSelectFieldKey, storageInstance, taxonomySelectUpdaterInstance);\n        }\n    }\n\n    // Gets the taxonomies and selected taxonomies from osm (added in PHP).\n    getOsm() {\n        let parsedData = {};\n\n        try {\n            parsedData = JSON.parse(osm);\n        } catch (error) {\n            console.error('Error parsing OSM data', error);\n        }\n\n        return [\n            parsedData.hasOwnProperty('taxonomies') ? parsedData.taxonomies : {}, \n            parsedData.hasOwnProperty('selected') ? parsedData.selected : {}\n        ];\n    }\n}\n\nexport default Module;","import TaxonomySelectUpdater from \"./taxonomySelectUpdater\";\nimport Storage from \"./storage\";\nimport Main from \"./main\";\n\nclass Gutenberg {\n    initializedOsmBlocks =  [];\n\n    constructor() {\n        this.editor = wp.data.select('core/block-editor');\n\n        // Listens for blocks added to the editor.\n        let handleOsmBlocksDebounced = null;\n\n        wp.data.subscribe(() => {\n            if (handleOsmBlocksDebounced) clearTimeout(handleOsmBlocksDebounced);\n\n            handleOsmBlocksDebounced = setTimeout(() => {\n                const osmBlockIds = this.editor.getBlocksByName('acf/open-street-map');\n                if (osmBlockIds.length === 0) {\n                    return;\n                }\n\n                osmBlockIds.forEach((osmBlockId) => {\n                    if (!this.initializedOsmBlocks.includes(osmBlockId)) {\n                        this.tryInitializeBlock(osmBlockId);\n                    }\n                });\n            }, 300);\n        });\n    }\n\n    // Initialize the block. \n    // Interval is added since the field is not the block fields have not been loaded right away.\n    initializeBlock(block, osmBlockId) {\n        const filterSelectFieldKey = 'field_668d1cc80d853';\n        const postTypeSelectFieldKey = 'field_642a8818a908c';\n\n        const [taxonomies, selected] = this.getOsm(osmBlockId);\n        const storageInstance = new Storage(taxonomies, selected);\n        const taxonomySelectUpdaterInstance = new TaxonomySelectUpdater(filterSelectFieldKey, storageInstance);\n        \n        const intervalId = setInterval(() => {\n            if (block.querySelector('[data-name=\"mod_osm_post_type\"]')) {\n                new Main(\n                    block, \n                    acf, \n                    postTypeSelectFieldKey, \n                    filterSelectFieldKey, \n                    storageInstance, \n                    taxonomySelectUpdaterInstance\n                );\n                \n                clearInterval(intervalId);\n            }\n        }, 1000);\n    }\n\n    // if the block is already initialized, skip it.\n    tryInitializeBlock(osmBlockId) {\n        const block = document.querySelector('#block-' + osmBlockId);\n        if (block) {\n            this.initializedOsmBlocks.push(osmBlockId);\n            this.initializeBlock(block, osmBlockId);\n        }\n    }\n\n    // Get the data (variable osm comes from PHP where all the taxonomies are already retrieved.)\n    getOsm(osmBlockId) {\n        let parsedData = {};\n\n        try {\n            parsedData = JSON.parse(osm);\n        } catch (error) {\n            console.error('Error parsing OSM data', error);\n        }\n\n        return [\n            parsedData.hasOwnProperty('taxonomies') ? parsedData.taxonomies : {},\n            this.getSelected(osmBlockId)\n        ];\n    }\n\n    // Gets the selected values from the block attributes.\n    getSelected(osmBlockId) {\n        const blockData = this.editor.getBlockAttributes(osmBlockId);\n        if (!blockData?.data?.mod_osm_post_type) {\n            return {};\n        }\n\n        let selected = {};\n        selected[blockData.data.mod_osm_post_type] = [];\n            \n        if (blockData?.data?.mod_osm_filters > 0) {\n            let i = 0;\n            for (i; i < blockData.data.mod_osm_filters; i++) {\n                if (blockData.data[`mod_osm_filters_${i}_mod_osm_filter_taxonomy`]) {\n                    selected[blockData.data.mod_osm_post_type].push(blockData.data[`mod_osm_filters_${i}_mod_osm_filter_taxonomy`]);\n                }\n            }\n        }\n\n        return selected;\n    }\n}\n\nexport default Gutenberg;","import Module from \"./module\";\nimport Gutenberg from \"./gutenberg\";\n\n// Initialize the correct class based on the context.\ndocument.addEventListener('DOMContentLoaded', function() {\n    if (typeof wp !== 'undefined' && typeof acf !== 'undefined') {\n        if (document.body.classList.contains('block-editor-page')) {\n            new Gutenberg();\n        } else {\n            new Module();\n        }\n    }\n});"],"names":["exports","constructor","selectFieldKey","storage","this","updateExistsingRows","container","postType","taxonomies","getTaxonomies","selectedValues","getSelected","querySelectorAll","forEach","selectField","index","innerHTML","addSelectFieldOptions","key","option","document","createElement","selected","value","text","appendChild","hasOwnProperty","acf","postTypeSelectFieldKey","filterSelectFieldKey","storageInstance","taxonomySelectUpdaterInstance","postTypeSelect","querySelector","listenForPostTypeChanges","listenForFilterRowsAdded","addEventListener","event","selectedValue","target","addAction","jqueryEl","classList","contains","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","getOsm","parsedData","JSON","parse","osm","error","console","initializedOsmBlocks","editor","wp","data","select","handleOsmBlocksDebounced","subscribe","clearTimeout","setTimeout","osmBlockIds","getBlocksByName","length","osmBlockId","includes","tryInitializeBlock","initializeBlock","block","intervalId","setInterval","clearInterval","push","blockData","getBlockAttributes","mod_osm_post_type","mod_osm_filters","i","body"],"ignoreList":[],"sourceRoot":""}